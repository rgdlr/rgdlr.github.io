<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario</title>
    <style>
        :root {
            --color: #111;
            --background-color: #eee;
        }

        body {
            color: var(--color);
            background-color: var(--background-color);
            font-family: system-ui;
        }

        *, *::after, *::before {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        svg {
            stroke: var(--color);
        }

        .calendar {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            margin-top: 0.5rem;
            margin-inline: auto;
            max-width: 50rem;
            min-width: fit-content;
            padding-inline: 0.5rem;
        }

        .calendar__nav {
            align-items: center;
            display: flex;
            gap: 0.5rem;
            justify-content: space-between;
        }

        .calendar__buttons {
            display: flex;
            gap: 0.5rem;
        }

        .calendar__button {
            align-items: center;
            aspect-ratio: 1;
            background-color: #5552;
            border: none;
            display: flex;
            justify-content: center;
            min-height: 2.5rem;
        }

        .calendar__button:hover {
            background-color: #5551;
        }

        .calendar__title,
        .calendar__next-office-day,
        .calendar__total-office-days {
            background-color: #5552;
            padding: 0.5rem;
        }

        .calendar__title {
            border-bottom: 0.1rem solid #5552;
            font-weight: bold;
            text-align: center;
            text-transform: uppercase;
        }

        .calendar__total-office-days {
            margin-bottom: 0.5rem;
        }

        .calendar__months {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 0.5rem;
            width: 100%;
        }

        .calendar__month {
            background-color: #5552;
            font-weight: bold;
            grid-column: span 7;
            padding: 0.5rem;
            text-align: center;
        }

        .calendar__weekday {
            background-color: #5551;
            font-weight: bold;
            padding: 0.5rem;
            text-align: center;
        }

        .calendar__day {
            min-height: 36px;
            padding: 0.5rem;
            text-align: center;
        }

        .calendar__day--office {
            background-color: #d3646499;
            font-weight: bold;
            position: relative;
        }

        .calendar__day--office::after {
            align-items: center;
            background-color: #faed7f;
            content: "Oficina";
            display: flex;
            font-size: 0.7rem;
            inset: 0;
            justify-content: center;
            opacity: 0;
            position: absolute;
            transition: opacity 500ms ease;
        }

        .calendar__day--office:hover::after {
            opacity: 1;
        }

        .calendar__today {
            outline: 0.1rem dashed #4646da;
            color: #4646da;
            font-weight: bold;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color: #eee;
                --background-color: #111;
            }
            .calendar__day--office {
                background-color: #91181899;
            }
        }
    </style>
</head>

<body>
    <div class="calendar">
        <div class="calendar__title">HaztePull</div>
        <div class="calendar__next-office-day"></div>
        <div class="calendar__total-office-days"></div>
        <div class="calendar__months"></div>
        <nav class="calendar__nav">
            <div class="calendar__buttons">
                <button class="calendar__button calendar__button--prev-year">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-left"><path d="m11 17-5-5 5-5"/><path d="m18 17-5-5 5-5"/></svg>
                </button>
                <button class="calendar__button calendar__button--prev-month">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg>
                </button>
            </div>
            <div class="calendar__buttons">
                <button class="calendar__button calendar__button--next-month">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg>
                </button>
                <button class="calendar__button calendar__button--next-year">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-right"><path d="m6 17 5-5-5-5"/><path d="m13 17 5-5-5-5"/></svg>
                </button>
            </div>
        </nav>
    </div>
    <script>
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        const months = [
            { name: 'Enero', days: 31 },
            { name: 'Febrero', days: 28 },
            { name: 'Marzo', days: 31 },
            { name: 'Abril', days: 30 },
            { name: 'Mayo', days: 31 },
            { name: 'Junio', days: 30 },
            { name: 'Julio', days: 31 },
            { name: 'Agosto', days: 31 },
            { name: 'Septiembre', days: 30 },
            { name: 'Octubre', days: 31 },
            { name: 'Noviembre', days: 30 },
            { name: 'Diciembre', days: 31 }
        ];

        function getWeekNumber(date) {
            date = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));
            const weekNumber = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
            return weekNumber;
        }

        function getOfficeDays(weekNumber, year) {
            const weekBase = 36;
            const yearBase = 2024;
            if (year < yearBase || (year === yearBase && weekNumber < weekBase)) {
                return [];
            }
            let weeksFromBase;
            if (year > yearBase || (year === yearBase && weekNumber >= weekBase)) {
                weeksFromBase = (year - yearBase) * 52 + (weekNumber - weekBase);
            } else {
                weeksFromBase = (year - yearBase) * 52 + (weekNumber - weekBase);
                if (weeksFromBase < 0) {
                    weeksFromBase = (year - yearBase) * 52 + (weekNumber - weekBase);
                }
            }
            const patternWeek = ((weeksFromBase % 3) + 3) % 3;
            if (patternWeek === 0 || patternWeek === 2) {
                return ['jueves', 'viernes'];
            } else if (patternWeek === 1) {
                return ['jueves'];
            }
            return [];
        }

        function renderCalendar() {
            const calendarElement = document.querySelector('.calendar__months');
            calendarElement.innerHTML = '';

            const month = months[currentMonth];
            const monthYearLabel = document.createElement('div');
            monthYearLabel.className = 'calendar__month';
            monthYearLabel.innerText = `${month.name} ${currentYear}`;
            calendarElement.appendChild(monthYearLabel);

            const dayHeaders = ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'];
            dayHeaders.forEach(header => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar__weekday';
                dayHeader.innerText = header;
                calendarElement.appendChild(dayHeader);
            });

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = month.days;

            const startDay = (firstDay === 0 ? 6 : firstDay - 1);
            const days = Array(startDay).fill(null);

            for (let day = 1; day <= daysInMonth; day++) {
                days.push(day);
            }

            const totalDays = days.length;
            const daysNeeded = 42 - totalDays;

            for (let i = 0; i < daysNeeded; i++) {
                days.push(null);
            }

            const today = new Date();
            const todayDay = today.getDate();
            const todayMonth = today.getMonth();
            const todayYear = today.getFullYear();

            days.forEach((day, i) => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar__day';

                if (day) {
                    dayElement.innerText = day;
                    const date = new Date(currentYear, currentMonth, day);
                    const weekNumber = getWeekNumber(date);
                    const officeDays = getOfficeDays(weekNumber, currentYear);
                    const dayOfWeek = date.toLocaleDateString('es-ES', { weekday: 'long' });
                    if (officeDays.includes(dayOfWeek)) {
                        dayElement.classList.add('calendar__day--office');
                    }
                    if (day === todayDay && currentMonth === todayMonth && currentYear === todayYear) {
                        dayElement.classList.add('calendar__today');
                    }
                }

                calendarElement.appendChild(dayElement);
            });
        }

        function getNextOfficeDay(date = new Date()) {
            const weekNumber = getWeekNumber(date);
            const officeDays = getOfficeDays(weekNumber, date.getFullYear());
            const dayOfWeek = date.toLocaleDateString('es-ES', { weekday: 'long' });
            if (officeDays.includes(dayOfWeek)) {
                return date;
            }
            date.setDate(date.getDate() + 1);
            return getNextOfficeDay(date);
        }

        function renderNextOfficeDay() {
            const nextOfficeDayElement = document.querySelector('.calendar__next-office-day');
            const nextOfficeDay = getNextOfficeDay();
            nextOfficeDayElement.innerHTML = `Día siguiente: <strong>${nextOfficeDay.toLocaleDateString('es-ES', { weekday: 'short', day: '2-digit', month: '2-digit' }).replace(',', '')}</strong>`;
        }

        function renderTotalOfficeDays() {
            const totalOfficeDaysElement = document.querySelector('.calendar__total-office-days');
            const daysFromChange = 0;
            totalOfficeDaysElement.innerHTML = `Días desde el cambio: <strong>${daysFromChange}</strong>`;
        }


        function prevYear() {
            currentYear--;
            renderCalendar();
        }

        function prevMonth() {
            if (currentMonth > 0) {
                currentMonth--;
            } else {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function nextMonth() {
            if (currentMonth < 11) {
                currentMonth++;
            } else {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }
        
        function nextYear() {
            currentYear++;
            renderCalendar();
        }

        function addButtonNavigationEventListeners () {
            const prevYearElement = document.querySelector('.calendar__button--prev-year');
            const prevMonthElement = document.querySelector('.calendar__button--prev-month');
            const nextMonthElement = document.querySelector('.calendar__button--next-month');
            const nextYearElement = document.querySelector('.calendar__button--next-year');

            function navigateListener(navigation, time) {
                const navigateYear = navigation === "prev" ? prevYear : nextYear;
                const navigateMonth = navigation === "prev" ? prevMonth : nextMonth;
                const navigate = time === "year" ? navigateYear : navigateMonth;
                return ["click", navigate];
            }

            prevYearElement.addEventListener(...navigateListener("prev", "year"));
            nextMonthElement.addEventListener(...navigateListener("next", "month"));
            prevMonthElement.addEventListener(...navigateListener("prev", "month"));
            nextYearElement.addEventListener(...navigateListener("next", "year"));

            const removeZoomOnDblClickListener = ["dblclick", function removeZoomOnDblClick (event) {
                event.preventDefault();
                event.stopPropagation();
            }];

            prevYearElement.addEventListener(...removeZoomOnDblClickListener);
            prevMonthElement.addEventListener(...removeZoomOnDblClickListener);
            nextMonthElement.addEventListener(...removeZoomOnDblClickListener);
            nextYearElement.addEventListener(...removeZoomOnDblClickListener);
        }

        function addSwipeNavigationEventListeners() {
            const calendarElement = document.querySelector('.calendar');

            let startX = 0;
            let endX = 0;
            let isMouseDown = false;

            function handleGesture() {
                if (endX < startX - 50) {
                    nextMonth();
                }

                if (endX > startX + 50) {
                    prevMonth();
                }
            }

            calendarElement.addEventListener('touchstart', (event) => {
                startX = event.changedTouches[0].screenX;
            });

            calendarElement.addEventListener('touchend', (event) => {
                endX = event.changedTouches[0].screenX;
                handleGesture();
            });

            calendarElement.addEventListener('mousedown', (event) => {
                startX = event.screenX;
                isMouseDown = true;
            });

            calendarElement.addEventListener('mousemove', (event) => {
                if (isMouseDown) {
                    endX = event.screenX;
                }
            });

            calendarElement.addEventListener('mouseup', (event) => {
                if (isMouseDown) {
                    endX = event.screenX;
                    handleGesture();
                    isMouseDown = false;
                }
            });

            calendarElement.addEventListener('mouseleave', () => {
                isMouseDown = false;
            });
        }

        renderCalendar();
        renderNextOfficeDay();
        renderTotalOfficeDays();

        addButtonNavigationEventListeners();
        addSwipeNavigationEventListeners();
    </script>
</body>

</html>